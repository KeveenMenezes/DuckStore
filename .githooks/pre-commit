#!/bin/sh

# Obtém a lista de arquivos C# modificados no índice (staged)
files=$(git diff --cached --name-only --diff-filter=ACM | grep '\.cs$')

# Se não houver arquivos C# modificados, sai do hook
if [ -z "$files" ]; then
  exit 0
fi

# Formata os arquivos modificados
echo "Formatando arquivos modificados..."
for file in $files; do
  # Executa o dotnet format no arquivo específico
  dotnet format DuckStore.sln --include "$file"
  
  # Verifica se o comando dotnet format foi bem-sucedido
  if [ $? -ne 0 ]; then
    echo "Erro ao formatar o arquivo: $file"
    exit 1
  fi

  # Re-adiciona o arquivo formatado ao índice
  git add "$file"
done

# Continua com o commit se todos os arquivos estiverem formatados
exit 0